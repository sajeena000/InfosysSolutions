import{_ as D}from"./ezhJEGkX.js";import{u as B}from"./D_M7QkOh.js";import{u as P}from"./BDJivQ1Z.js";import{r as c,k as A,c as n,a as t,t as r,q as a,G as k,b as $,F as x,z as v,m as F,o as i,B as V}from"./PsU8fGEG.js";const M={class:"space-y-8"},N={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},z={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},O={class:"text-3xl font-display font-bold text-white"},q={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},L={class:"text-3xl font-display font-bold text-white"},E={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},G={class:"text-3xl font-display font-bold text-white"},I={class:"mt-4 h-1 w-full bg-slate-800 rounded-full overflow-hidden"},H={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm flex flex-col"},J={class:"h-64 w-full"},K={class:"mt-4 flex justify-between text-xs text-slate-500"},Q={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},U={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm"},W={class:"space-y-5"},X={class:"flex justify-between text-sm mb-1"},Y={class:"text-slate-300 font-medium"},Z={class:"text-slate-400"},tt={class:"h-2 w-full bg-slate-950 rounded-full overflow-hidden border border-white/5"},et={key:0,class:"text-sm text-slate-500 italic text-center py-4"},st={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm"},lt={class:"flex items-center gap-8 mb-8"},ot={class:"relative w-40 h-40"},at={class:"w-full h-full -rotate-90",viewBox:"0 0 32 32"},nt=["stroke","stroke-dasharray","stroke-dashoffset"],rt={class:"absolute inset-0 flex items-center justify-center"},it={class:"text-center"},dt={class:"text-2xl font-bold text-white"},ct={class:"flex-1 space-y-3"},ut={class:"text-sm text-slate-300 flex-1"},pt={class:"text-sm text-slate-400"},mt={class:"text-sm text-slate-400"},gt={__name:"analytics",setup(ht){const{formatCurrency:b}=B(),{downloadCSV:j}=P(),d=c({pipelineValue:0,avgContractValue:0,retentionRate:0}),g=c([]),w=c([]),p=c([]),m=c([]),y=c(0),_=c("Loading insights..."),h=["bg-indigo-500","bg-purple-500","bg-emerald-500","bg-amber-500","bg-rose-500","bg-sky-500"],C=["#6366f1","#a855f7","#10b981","#f59e0b","#f43f5e","#0ea5e9"],R=async()=>{try{const o=await $fetch("/api/admin/analytics-stats");d.value={pipelineValue:o.pipelineValue||0,avgContractValue:o.avgContractValue||0,retentionRate:o.retentionRate||0},g.value=o.chartData||[],w.value=o.revenueTrends||[];const e=o.maxClientValue||1;p.value=(o.topClients||[]).map((s,l)=>({...s,color:h[l%h.length],percentage:Math.round(s.value/e*100)}));let u=0;m.value=(o.projectTypes||[]).map((s,l)=>{const f=s.percentage,T={...s,bgColor:h[l%h.length],strokeColor:C[l%C.length],dashArray:f,dashOffset:u};return u+=f,T}),y.value=o.totalProjects||0,_.value=o.insights||"Add projects to see insights here."}catch(o){console.error("Failed to fetch analytics data:",o),_.value="Failed to load analytics data."}};A(()=>{R()});const S=()=>{const o=["Month","Revenue","Chart Value (%)"],e=w.value.map((l,f)=>[l.month,l.value,g.value[f]||0]),u=[[],["Summary Metrics"],["Pipeline Value",d.value.pipelineValue],["Avg Contract Value",d.value.avgContractValue],["Retention Rate (%)",d.value.retentionRate],[],["Top Clients"],...p.value.map(l=>[l.name,l.value]),[],["Project Types"],...m.value.map(l=>[l.name,l.count,`${l.percentage}%`])],s=[...e,...u];j(o,s,`analytics_report_${new Date().toISOString().split("T")[0]}.csv`)};return(o,e)=>{const u=D;return i(),n("div",M,[t("div",{class:"flex items-center justify-between"},[e[0]||(e[0]=t("div",null,[t("h1",{class:"text-3xl font-display font-bold text-white mb-2"},"Analytics"),t("p",{class:"text-slate-400"},"Business metrics and project insights.")],-1)),t("div",{class:"flex gap-2"},[t("button",{onClick:S,class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg text-sm font-medium border border-white/10 transition-colors"}," Download CSV ")])]),t("div",N,[t("div",z,[e[1]||(e[1]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[2]||(e[2]=t("p",{class:"text-slate-400 text-sm mb-1"},"Pipeline Value",-1)),t("p",O,r(a(b)(a(d).pipelineValue)),1),e[3]||(e[3]=t("p",{class:"text-xs text-slate-500 mt-2"},"Pending projects waiting in queue",-1))]),t("div",q,[e[4]||(e[4]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[5]||(e[5]=t("p",{class:"text-slate-400 text-sm mb-1"},"Avg. Contract Value",-1)),t("p",L,r(a(b)(a(d).avgContractValue)),1),e[6]||(e[6]=t("div",{class:"mt-4 h-1 w-full bg-slate-800 rounded-full overflow-hidden"},[t("div",{class:"h-full bg-emerald-500 w-[65%]"})],-1))]),t("div",E,[e[7]||(e[7]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-purple-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[8]||(e[8]=t("p",{class:"text-slate-400 text-sm mb-1"},"Client Retention",-1)),t("p",G,r(a(d).retentionRate)+"%",1),t("div",I,[t("div",{class:"h-full bg-purple-500 transition-all duration-500",style:k({width:a(d).retentionRate+"%"})},null,4)])])]),t("div",H,[e[9]||(e[9]=t("div",{class:"flex items-center justify-between mb-6"},[t("div",null,[t("h2",{class:"text-lg font-display font-semibold text-white"},"Revenue Trends"),t("p",{class:"text-xs text-slate-500 mt-1"},"Based on project start dates (active + completed)")])],-1)),t("div",J,[$(u,{data:a(g)},null,8,["data"])]),t("div",K,[(i(!0),n(x,null,v(a(w),(s,l)=>(i(),n("span",{key:l,class:"flex-1 text-center"},r(s.month),1))),128))])]),t("div",Q,[t("div",U,[e[10]||(e[10]=t("h3",{class:"text-lg font-display font-semibold text-white mb-6"},"Top Clients",-1)),t("div",W,[(i(!0),n(x,null,v(a(p),s=>(i(),n("div",{key:s.name,class:"group"},[t("div",X,[t("span",Y,r(s.name),1),t("span",Z,r(a(b)(s.value)),1)]),t("div",tt,[t("div",{class:V(["h-full rounded-full transition-all duration-1000 group-hover:brightness-125",s.color]),style:k({width:s.percentage+"%"})},null,6)])]))),128)),a(p).length===0?(i(),n("div",et," No project data available yet. ")):F("",!0)])]),t("div",st,[e[12]||(e[12]=t("h3",{class:"text-lg font-display font-semibold text-white mb-6"},"Project Type Breakdown",-1)),t("div",lt,[t("div",ot,[(i(),n("svg",at,[(i(!0),n(x,null,v(a(m),(s,l)=>(i(),n("circle",{key:s.name,r:"16",cx:"16",cy:"16",fill:"transparent",stroke:s.strokeColor,"stroke-width":"6","stroke-dasharray":`${s.dashArray} 100`,"stroke-dashoffset":`-${s.dashOffset}`,class:"transition-all duration-500"},null,8,nt))),128))])),t("div",rt,[t("div",it,[t("p",dt,r(a(y)),1),e[11]||(e[11]=t("p",{class:"text-xs text-slate-500"},"Projects",-1))])])]),t("div",ct,[(i(!0),n(x,null,v(a(m),s=>(i(),n("div",{key:s.name,class:"flex items-center gap-3"},[t("div",{class:V(["w-3 h-3 rounded-full",s.bgColor])},null,2),t("span",ut,r(s.name),1),t("span",pt,r(s.count)+" ("+r(s.percentage)+"%)",1)]))),128))])]),t("p",mt,r(a(_)),1)])])])}}};export{gt as default};
