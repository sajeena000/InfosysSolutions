import{_ as L}from"./BlqDiOG6.js";import{_ as U}from"./9SQ5mlpr.js";import{g as V,r,k as D,x as j,c as d,a as t,y as g,m as E,b as S,F as C,z as M,t as o,q as a,s as Q,o as l,B as m,d as G}from"./PsU8fGEG.js";import{u as W}from"./D_M7QkOh.js";import{C as q}from"./bv-9-H5o.js";import{W as H}from"./BZ0gSUa8.js";import{B as I}from"./B5H3Xi1M.js";import{G as O}from"./DwNSE9hR.js";import{C as J}from"./iGtZsUXi.js";import"./ZVIKdQKX.js";import"./w7z5CoPY.js";import"./DlAUqK2U.js";import"./DUIq94hi.js";import"./C0WVU3vH.js";const K={class:"space-y-8"},X={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Y={class:"flex flex-wrap gap-2"},Z=["onClick"],tt={class:"flex flex-wrap gap-2"},et=["onClick"],st={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},at={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},ot={class:"text-2xl font-display font-bold text-white"},lt={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},nt={class:"text-2xl font-display font-bold text-emerald-400"},it={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},rt={class:"text-2xl font-display font-bold text-amber-400"},dt={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},ct={class:"text-2xl font-display font-bold text-white"},pt={key:0,class:"text-center py-20"},ut={key:1,class:"text-center py-20 border border-dashed border-white/10 rounded-2xl"},xt={class:"text-slate-400"},mt={key:2,class:"overflow-x-auto rounded-2xl border border-white/5"},ht={class:"w-full text-left"},gt={class:"divide-y divide-white/5"},ft={class:"px-6 py-4"},bt={class:"text-sm font-medium text-white"},_t={class:"text-xs text-slate-500"},yt={class:"px-6 py-4"},vt={class:"text-sm text-slate-300 max-w-[200px] truncate"},wt={class:"text-xs text-slate-500"},kt={class:"px-6 py-4"},Pt={class:"px-6 py-4"},St={class:"text-sm font-semibold text-white"},Ct={class:"px-6 py-4"},Mt={class:"flex items-center gap-2"},Tt={class:"text-xs text-slate-400 capitalize"},Bt={class:"px-6 py-4"},Ft={class:"px-6 py-4"},$t={class:"text-xs text-slate-500"},jt={class:"px-6 py-4"},Nt=["value","onChange"],Rt={key:1,class:"flex items-center gap-1 text-emerald-400 text-xs"},Kt={__name:"payments",setup(zt){const f=V(),{formatDate:N}=W(),b=r([]),_=r(!0),c=r("all"),u=r("all"),T=r(null),y=r(""),v=r(""),w=r("success"),p=r(1),k=r(0),B=r(10),R=["all","pending","paid","failed","cancelled"],z=["all","esewa","paypal","onsite"],x=r({total:0,paid:0,pending:0,revenue:0}),F=async()=>{_.value=!0;try{const i=await $fetch("/api/admin/payments",{params:{page:p.value,limit:B.value,status:c.value,method:u.value,search:f.searchQuery}});b.value=i.data,k.value=i.meta.total}catch(i){console.error("Failed to fetch payments:",i)}finally{_.value=!1}},$=async()=>{try{const i=await $fetch("/api/admin/payments",{params:{limit:100}}),s=i.data||[];x.value={total:i.meta.total,paid:s.filter(n=>n.paymentStatus==="paid").length,pending:s.filter(n=>n.paymentStatus==="pending").length,revenue:s.filter(n=>n.paymentStatus==="paid").reduce((n,h)=>n+(h.amount||0),0)}}catch(i){console.error("Failed to fetch stats:",i)}};D(()=>{F(),$()}),j([p,c,u,()=>f.searchQuery],()=>{F()}),j([c,u,()=>f.searchQuery],()=>{p.value=1});const A=async(i,s)=>{const n=i.target.value;try{await $fetch(`/api/admin/payments/${s.id}`,{method:"PATCH",body:{paymentStatus:n}}),s.paymentStatus=n,y.value="Updated",v.value=`Payment status changed to "${n}".`,w.value="success",$()}catch{y.value="Error",v.value="Failed to update payment status.",w.value="error"}T.value.show()};return(i,s)=>{const n=L,h=U;return l(),d("div",K,[t("div",X,[s[1]||(s[1]=t("div",null,[t("h1",{class:"text-3xl font-display font-bold text-white mb-2"},"Payments"),t("p",{class:"text-slate-400"},"Track and manage all project submissions & payments.")],-1)),t("div",Y,[(l(),d(C,null,M(R,e=>t("button",{key:e,onClick:P=>c.value=e,class:m(["px-3 py-1.5 rounded-lg text-xs font-medium capitalize transition-all",a(c)===e?"bg-indigo-600 text-white":"bg-white/5 text-slate-400 hover:text-white"])},o(e),11,Z)),64))])]),t("div",tt,[s[2]||(s[2]=t("span",{class:"text-xs text-slate-500 self-center mr-1"},"Method:",-1)),(l(),d(C,null,M(z,e=>t("button",{key:e,onClick:P=>u.value=e,class:m(["px-3 py-1.5 rounded-lg text-xs font-medium capitalize transition-all",a(u)===e?"bg-slate-700 text-white":"bg-white/5 text-slate-400 hover:text-white"])},o(e==="esewa"?"eSewa":e==="paypal"?"PayPal":e),11,et)),64))]),t("div",st,[t("div",at,[s[3]||(s[3]=t("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Total Submissions",-1)),t("p",ot,o(a(x).total),1)]),t("div",lt,[s[4]||(s[4]=t("p",{class:"text-xs text-emerald-400 uppercase tracking-wider mb-1"},"Paid",-1)),t("p",nt,o(a(x).paid),1)]),t("div",it,[s[5]||(s[5]=t("p",{class:"text-xs text-amber-400 uppercase tracking-wider mb-1"},"Pending",-1)),t("p",rt,o(a(x).pending),1)]),t("div",dt,[s[6]||(s[6]=t("p",{class:"text-xs text-slate-400 uppercase tracking-wider mb-1"},"Total Revenue",-1)),t("p",ct,"Rs. "+o(a(x).revenue.toLocaleString()),1)])]),a(_)?(l(),d("div",pt,[...s[7]||(s[7]=[t("div",{class:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto"},null,-1),t("p",{class:"text-slate-500 mt-4"},"Loading payments...",-1)])])):a(b).length===0?(l(),d("div",ut,[S(a(q),{class:"w-12 h-12 text-slate-500 mx-auto mb-4"}),t("p",xt,"No "+o(a(c)==="all"?"":a(c))+" payments found",1)])):(l(),d("div",mt,[t("table",ht,[s[10]||(s[10]=t("thead",null,[t("tr",{class:"bg-slate-900/60 text-xs text-slate-400 uppercase tracking-wider"},[t("th",{class:"px-6 py-4 font-medium"},"Client"),t("th",{class:"px-6 py-4 font-medium"},"Project"),t("th",{class:"px-6 py-4 font-medium"},"Plan"),t("th",{class:"px-6 py-4 font-medium"},"Amount"),t("th",{class:"px-6 py-4 font-medium"},"Method"),t("th",{class:"px-6 py-4 font-medium"},"Status"),t("th",{class:"px-6 py-4 font-medium"},"Date"),t("th",{class:"px-6 py-4 font-medium"},"Action")])],-1)),t("tbody",gt,[(l(!0),d(C,null,M(a(b),e=>(l(),d("tr",{key:e.id,class:"bg-slate-900/30 hover:bg-slate-800/50 transition-colors"},[t("td",ft,[t("div",null,[t("p",bt,o(e.fullName),1),t("p",_t,o(e.email),1)])]),t("td",yt,[t("p",vt,o(e.projectTitle),1),t("p",wt,o(e.projectType),1)]),t("td",kt,[t("span",{class:m(["px-2 py-1 text-[10px] font-medium uppercase tracking-wider rounded-full",{"bg-blue-500/20 text-blue-400":e.pricingPackage==="Basic","bg-purple-500/20 text-purple-400":e.pricingPackage==="Professional","bg-amber-500/20 text-amber-400":e.pricingPackage==="Enterprise","bg-slate-500/20 text-slate-400":e.pricingPackage==="Custom"}])},o(e.pricingPackage),3)]),t("td",Pt,[t("span",St,"Rs. "+o(e.amount?.toLocaleString()),1)]),t("td",Ct,[t("div",Mt,[t("div",{class:m(["w-6 h-6 rounded-md flex items-center justify-center text-[10px] font-bold",{"bg-emerald-500/20 text-emerald-400":e.paymentMethod==="esewa","bg-blue-500/20 text-blue-400":e.paymentMethod==="onsite","bg-blue-700/20 text-blue-300":e.paymentMethod==="paypal"}])},[e.paymentMethod==="esewa"?(l(),g(a(H),{key:0,class:"w-3.5 h-3.5"})):e.paymentMethod==="onsite"?(l(),g(a(I),{key:1,class:"w-3.5 h-3.5"})):(l(),g(a(O),{key:2,class:"w-3.5 h-3.5"}))],2),t("span",Tt,o(e.paymentMethod==="esewa"?"eSewa":e.paymentMethod==="paypal"?"PayPal":"Onsite"),1)])]),t("td",Bt,[t("span",{class:m(["px-2.5 py-1 text-[10px] font-medium uppercase tracking-wider rounded-full",{"bg-emerald-500/20 text-emerald-400":e.paymentStatus==="paid","bg-amber-500/20 text-amber-400":e.paymentStatus==="pending","bg-rose-500/20 text-rose-400":e.paymentStatus==="failed","bg-slate-500/20 text-slate-400":e.paymentStatus==="cancelled"}])},o(e.paymentStatus),3)]),t("td",Ft,[t("span",$t,o(a(N)(e.createdAt,"withTime")),1)]),t("td",jt,[e.paymentStatus!=="paid"?(l(),d("select",{key:0,value:e.paymentStatus,onChange:P=>A(P,e),class:"bg-slate-950 border border-white/10 rounded-lg text-xs text-slate-300 px-2 py-1.5 outline-none focus:border-indigo-500 transition-colors"},[...s[8]||(s[8]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"paid"},"Mark Paid",-1),t("option",{value:"failed"},"Failed",-1),t("option",{value:"cancelled"},"Cancelled",-1)])],40,Nt)):(l(),d("span",Rt,[S(a(J),{class:"w-4 h-4"}),s[9]||(s[9]=G(" Completed ",-1))]))])]))),128))])])])),a(k)>0?(l(),g(n,{key:3,"current-page":a(p),"onUpdate:currentPage":s[0]||(s[0]=e=>Q(p)?p.value=e:null),total:a(k),"items-per-page":a(B)},null,8,["current-page","total","items-per-page"])):E("",!0),S(h,{ref_key:"toastRef",ref:T,title:a(y),message:a(v),type:a(w)},null,8,["title","message","type"])])}}};export{Kt as default};
