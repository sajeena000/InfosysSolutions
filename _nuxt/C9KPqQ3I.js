import{_ as A}from"./BMwXZSN9.js";import{_ as D}from"./CNrVL5MK.js";import{g as L,r,k as V,x as j,c as d,a as t,y as g,m as E,b as S,F as C,z as M,t as o,q as a,s as Q,o as n,B as m,d as G}from"./C1Naxxgm.js";import{C as W}from"./n9oooa1w.js";import{W as q}from"./BFwr6WN5.js";import{B as H}from"./CbMxIKka.js";import{G as I}from"./D1G2Ozpz.js";import{C as O}from"./LGXOS62J.js";import"./DNMMp6NS.js";import"./C2RmjbcW.js";import"./DlAUqK2U.js";import"./D9cmgT4F.js";import"./CQtQxwJX.js";const J={class:"space-y-8"},K={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},X={class:"flex flex-wrap gap-2"},Y=["onClick"],Z={class:"flex flex-wrap gap-2"},tt=["onClick"],et={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},st={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},at={class:"text-2xl font-display font-bold text-white"},ot={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},lt={class:"text-2xl font-display font-bold text-emerald-400"},nt={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},it={class:"text-2xl font-display font-bold text-amber-400"},rt={class:"p-4 rounded-2xl bg-slate-900/40 border border-white/5"},dt={class:"text-2xl font-display font-bold text-white"},ct={key:0,class:"text-center py-20"},pt={key:1,class:"text-center py-20 border border-dashed border-white/10 rounded-2xl"},ut={class:"text-slate-400"},xt={key:2,class:"overflow-x-auto rounded-2xl border border-white/5"},mt={class:"w-full text-left"},ht={class:"divide-y divide-white/5"},gt={class:"px-6 py-4"},ft={class:"text-sm font-medium text-white"},bt={class:"text-xs text-slate-500"},yt={class:"px-6 py-4"},_t={class:"text-sm text-slate-300 max-w-[200px] truncate"},vt={class:"text-xs text-slate-500"},wt={class:"px-6 py-4"},kt={class:"px-6 py-4"},Pt={class:"text-sm font-semibold text-white"},St={class:"px-6 py-4"},Ct={class:"flex items-center gap-2"},Mt={class:"text-xs text-slate-400 capitalize"},Tt={class:"px-6 py-4"},Bt={class:"px-6 py-4"},Ft={class:"text-xs text-slate-500"},$t={class:"px-6 py-4"},jt=["value","onChange"],Nt={key:1,class:"flex items-center gap-1 text-emerald-400 text-xs"},Ot={__name:"payments",setup(Rt){const f=L(),b=r([]),y=r(!0),c=r("all"),u=r("all"),T=r(null),_=r(""),v=r(""),w=r("success"),p=r(1),k=r(0),B=r(10),N=["all","pending","paid","failed","cancelled"],R=["all","esewa","paypal","onsite"],x=r({total:0,paid:0,pending:0,revenue:0}),F=async()=>{y.value=!0;try{const l=await $fetch("/api/admin/payments",{params:{page:p.value,limit:B.value,status:c.value,method:u.value,search:f.searchQuery}});b.value=l.data,k.value=l.meta.total}catch(l){console.error("Failed to fetch payments:",l)}finally{y.value=!1}},$=async()=>{try{const l=await $fetch("/api/admin/payments",{params:{limit:100}}),s=l.data||[];x.value={total:l.meta.total,paid:s.filter(i=>i.paymentStatus==="paid").length,pending:s.filter(i=>i.paymentStatus==="pending").length,revenue:s.filter(i=>i.paymentStatus==="paid").reduce((i,h)=>i+(h.amount||0),0)}}catch(l){console.error("Failed to fetch stats:",l)}};V(()=>{F(),$()}),j([p,c,u,()=>f.searchQuery],()=>{F()}),j([c,u,()=>f.searchQuery],()=>{p.value=1});const U=async(l,s)=>{const i=l.target.value;try{await $fetch(`/api/admin/payments/${s.id}`,{method:"PATCH",body:{paymentStatus:i}}),s.paymentStatus=i,_.value="Updated",v.value=`Payment status changed to "${i}".`,w.value="success",$()}catch{_.value="Error",v.value="Failed to update payment status.",w.value="error"}T.value.show()},z=l=>l?new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown";return(l,s)=>{const i=A,h=D;return n(),d("div",J,[t("div",K,[s[1]||(s[1]=t("div",null,[t("h1",{class:"text-3xl font-display font-bold text-white mb-2"},"Payments"),t("p",{class:"text-slate-400"},"Track and manage all project submissions & payments.")],-1)),t("div",X,[(n(),d(C,null,M(N,e=>t("button",{key:e,onClick:P=>c.value=e,class:m(["px-3 py-1.5 rounded-lg text-xs font-medium capitalize transition-all",a(c)===e?"bg-indigo-600 text-white":"bg-white/5 text-slate-400 hover:text-white"])},o(e),11,Y)),64))])]),t("div",Z,[s[2]||(s[2]=t("span",{class:"text-xs text-slate-500 self-center mr-1"},"Method:",-1)),(n(),d(C,null,M(R,e=>t("button",{key:e,onClick:P=>u.value=e,class:m(["px-3 py-1.5 rounded-lg text-xs font-medium capitalize transition-all",a(u)===e?"bg-slate-700 text-white":"bg-white/5 text-slate-400 hover:text-white"])},o(e==="esewa"?"eSewa":e==="paypal"?"PayPal":e),11,tt)),64))]),t("div",et,[t("div",st,[s[3]||(s[3]=t("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Total Submissions",-1)),t("p",at,o(a(x).total),1)]),t("div",ot,[s[4]||(s[4]=t("p",{class:"text-xs text-emerald-400 uppercase tracking-wider mb-1"},"Paid",-1)),t("p",lt,o(a(x).paid),1)]),t("div",nt,[s[5]||(s[5]=t("p",{class:"text-xs text-amber-400 uppercase tracking-wider mb-1"},"Pending",-1)),t("p",it,o(a(x).pending),1)]),t("div",rt,[s[6]||(s[6]=t("p",{class:"text-xs text-slate-400 uppercase tracking-wider mb-1"},"Total Revenue",-1)),t("p",dt,"Rs. "+o(a(x).revenue.toLocaleString()),1)])]),a(y)?(n(),d("div",ct,[...s[7]||(s[7]=[t("div",{class:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto"},null,-1),t("p",{class:"text-slate-500 mt-4"},"Loading payments...",-1)])])):a(b).length===0?(n(),d("div",pt,[S(a(W),{class:"w-12 h-12 text-slate-500 mx-auto mb-4"}),t("p",ut,"No "+o(a(c)==="all"?"":a(c))+" payments found",1)])):(n(),d("div",xt,[t("table",mt,[s[10]||(s[10]=t("thead",null,[t("tr",{class:"bg-slate-900/60 text-xs text-slate-400 uppercase tracking-wider"},[t("th",{class:"px-6 py-4 font-medium"},"Client"),t("th",{class:"px-6 py-4 font-medium"},"Project"),t("th",{class:"px-6 py-4 font-medium"},"Plan"),t("th",{class:"px-6 py-4 font-medium"},"Amount"),t("th",{class:"px-6 py-4 font-medium"},"Method"),t("th",{class:"px-6 py-4 font-medium"},"Status"),t("th",{class:"px-6 py-4 font-medium"},"Date"),t("th",{class:"px-6 py-4 font-medium"},"Action")])],-1)),t("tbody",ht,[(n(!0),d(C,null,M(a(b),e=>(n(),d("tr",{key:e.id,class:"bg-slate-900/30 hover:bg-slate-800/50 transition-colors"},[t("td",gt,[t("div",null,[t("p",ft,o(e.fullName),1),t("p",bt,o(e.email),1)])]),t("td",yt,[t("p",_t,o(e.projectTitle),1),t("p",vt,o(e.projectType),1)]),t("td",wt,[t("span",{class:m(["px-2 py-1 text-[10px] font-medium uppercase tracking-wider rounded-full",{"bg-blue-500/20 text-blue-400":e.pricingPackage==="Basic","bg-purple-500/20 text-purple-400":e.pricingPackage==="Professional","bg-amber-500/20 text-amber-400":e.pricingPackage==="Enterprise","bg-slate-500/20 text-slate-400":e.pricingPackage==="Custom"}])},o(e.pricingPackage),3)]),t("td",kt,[t("span",Pt,"Rs. "+o(e.amount?.toLocaleString()),1)]),t("td",St,[t("div",Ct,[t("div",{class:m(["w-6 h-6 rounded-md flex items-center justify-center text-[10px] font-bold",{"bg-emerald-500/20 text-emerald-400":e.paymentMethod==="esewa","bg-blue-500/20 text-blue-400":e.paymentMethod==="onsite","bg-blue-700/20 text-blue-300":e.paymentMethod==="paypal"}])},[e.paymentMethod==="esewa"?(n(),g(a(q),{key:0,class:"w-3.5 h-3.5"})):e.paymentMethod==="onsite"?(n(),g(a(H),{key:1,class:"w-3.5 h-3.5"})):(n(),g(a(I),{key:2,class:"w-3.5 h-3.5"}))],2),t("span",Mt,o(e.paymentMethod==="esewa"?"eSewa":e.paymentMethod==="paypal"?"PayPal":"Onsite"),1)])]),t("td",Tt,[t("span",{class:m(["px-2.5 py-1 text-[10px] font-medium uppercase tracking-wider rounded-full",{"bg-emerald-500/20 text-emerald-400":e.paymentStatus==="paid","bg-amber-500/20 text-amber-400":e.paymentStatus==="pending","bg-rose-500/20 text-rose-400":e.paymentStatus==="failed","bg-slate-500/20 text-slate-400":e.paymentStatus==="cancelled"}])},o(e.paymentStatus),3)]),t("td",Bt,[t("span",Ft,o(z(e.createdAt)),1)]),t("td",$t,[e.paymentStatus!=="paid"?(n(),d("select",{key:0,value:e.paymentStatus,onChange:P=>U(P,e),class:"bg-slate-950 border border-white/10 rounded-lg text-xs text-slate-300 px-2 py-1.5 outline-none focus:border-indigo-500 transition-colors"},[...s[8]||(s[8]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"paid"},"Mark Paid",-1),t("option",{value:"failed"},"Failed",-1),t("option",{value:"cancelled"},"Cancelled",-1)])],40,jt)):(n(),d("span",Nt,[S(a(O),{class:"w-4 h-4"}),s[9]||(s[9]=G(" Completed ",-1))]))])]))),128))])])])),a(k)>0?(n(),g(i,{key:3,"current-page":a(p),"onUpdate:currentPage":s[0]||(s[0]=e=>Q(p)?p.value=e:null),total:a(k),"items-per-page":a(B)},null,8,["current-page","total","items-per-page"])):E("",!0),S(h,{ref_key:"toastRef",ref:T,title:a(_),message:a(v),type:a(w)},null,8,["title","message","type"])])}}};export{Ot as default};
