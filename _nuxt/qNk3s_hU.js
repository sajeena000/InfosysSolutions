import{r as d,x as E,y as U,o as p,b as g,w as M,c as b,m as k,a as e,q as t,n as T,p as P,s as v,v as $,t as _,E as N,T as R,g as Y,j as G,d as C,B as S}from"./C1Naxxgm.js";import{_ as j}from"./DlAUqK2U.js";import{M as L}from"./-TCYIu1i.js";import{c as H}from"./C2RmjbcW.js";import{_ as J}from"./CNrVL5MK.js";import{S as K}from"./_n0tJLBN.js";import{L as Q}from"./DmiwjqRO.js";import"./D9cmgT4F.js";import"./CQtQxwJX.js";const A=H("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),W={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center px-4"},X={class:"relative w-full max-w-md bg-slate-900 border border-white/10 rounded-2xl shadow-2xl p-6 overflow-hidden transform transition-all"},Z={class:"relative z-10"},ee={class:"flex items-center gap-3 mb-6"},te={class:"w-10 h-10 bg-indigo-500/10 rounded-full flex items-center justify-center"},se={class:"space-y-1"},oe={class:"space-y-1"},le={key:0,class:"text-rose-400 text-sm text-center bg-rose-500/10 py-2 rounded-lg border border-rose-500/20"},ae={class:"flex gap-3 pt-2"},ie=["disabled"],ne={key:0},re={key:1,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},de={__name:"UiChangeEmailModal",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(y,{emit:a}){const V=y,x=a,u=d(""),n=d(""),i=d(!1),c=d(""),f=async()=>{i.value=!0,c.value="";try{const m=await $fetch("/api/admin/change-email",{method:"POST",body:{newEmail:u.value,currentPassword:n.value}});x("success",m),x("update:modelValue",!1),u.value="",n.value=""}catch(m){c.value=m.data?.message||m.statusMessage||"Failed to change email"}finally{i.value=!1}};return E(()=>V.modelValue,m=>{m||(u.value="",n.value="",c.value="")}),(m,l)=>(p(),U(R,{to:"body"},[g(N,{name:"modal"},{default:M(()=>[y.modelValue?(p(),b("div",W,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:l[0]||(l[0]=s=>m.$emit("update:modelValue",!1))}),e("div",X,[l[7]||(l[7]=e("div",{class:"absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none"},null,-1)),e("div",Z,[e("div",ee,[e("div",te,[g(t(L),{class:"w-5 h-5 text-indigo-500"})]),l[4]||(l[4]=e("h3",{class:"text-xl font-display font-bold text-white"},"Change Email",-1))]),e("form",{onSubmit:T(f,["prevent"]),class:"space-y-4"},[e("div",se,[l[5]||(l[5]=e("label",{class:"text-sm font-medium text-slate-300"},"New Email Address",-1)),P(e("input",{"onUpdate:modelValue":l[1]||(l[1]=s=>v(u)?u.value=s:null),type:"email",placeholder:"Enter new email",class:"w-full bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all",required:""},null,512),[[$,t(u)]])]),e("div",oe,[l[6]||(l[6]=e("label",{class:"text-sm font-medium text-slate-300"},"Current Password",-1)),P(e("input",{"onUpdate:modelValue":l[2]||(l[2]=s=>v(n)?n.value=s:null),type:"password",placeholder:"Enter your current password",class:"w-full bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all",required:""},null,512),[[$,t(n)]])]),t(c)?(p(),b("div",le,_(t(c)),1)):k("",!0),e("div",ae,[e("button",{type:"button",onClick:l[3]||(l[3]=s=>m.$emit("update:modelValue",!1)),class:"flex-1 px-4 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 text-white text-sm font-medium border border-white/5 transition-colors"}," Cancel "),e("button",{type:"submit",disabled:t(i),class:"flex-1 px-4 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-50 flex items-center justify-center"},[t(i)?(p(),b("div",re)):(p(),b("span",ne,"Update Email"))],8,ie)])],32)])])])):k("",!0)]),_:1})]))}},ue=j(de,[["__scopeId","data-v-407b3bb0"]]),me={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center px-4"},ce={class:"relative w-full max-w-md bg-slate-900 border border-white/10 rounded-2xl shadow-2xl p-6 overflow-hidden transform transition-all"},pe={class:"relative z-10"},fe={class:"flex items-center gap-3 mb-6"},be={class:"w-10 h-10 bg-indigo-500/10 rounded-full flex items-center justify-center"},ge={class:"space-y-1"},we={class:"space-y-1"},xe={class:"space-y-1"},he={key:0,class:"text-rose-400 text-sm text-center bg-rose-500/10 py-2 rounded-lg border border-rose-500/20"},ve={class:"flex gap-3 pt-2"},ye=["disabled"],_e={key:0},Pe={key:1,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},$e={__name:"UiChangePasswordModal",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(y,{emit:a}){const V=y,x=a,u=d(""),n=d(""),i=d(""),c=d(!1),f=d(""),m=async()=>{if(n.value!==i.value){f.value="New passwords do not match";return}if(n.value.length<6){f.value="Password must be at least 6 characters";return}c.value=!0,f.value="";try{await $fetch("/api/admin/change-password",{method:"POST",body:{currentPassword:u.value,newPassword:n.value,confirmPassword:i.value}}),x("success"),x("update:modelValue",!1),u.value="",n.value="",i.value=""}catch(l){f.value=l.data?.message||l.statusMessage||"Failed to change password"}finally{c.value=!1}};return E(()=>V.modelValue,l=>{l||(u.value="",n.value="",i.value="",f.value="")}),(l,s)=>(p(),U(R,{to:"body"},[g(N,{name:"modal"},{default:M(()=>[y.modelValue?(p(),b("div",me,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s[0]||(s[0]=w=>l.$emit("update:modelValue",!1))}),e("div",ce,[s[9]||(s[9]=e("div",{class:"absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none"},null,-1)),e("div",pe,[e("div",fe,[e("div",be,[g(t(A),{class:"w-5 h-5 text-indigo-500"})]),s[5]||(s[5]=e("h3",{class:"text-xl font-display font-bold text-white"},"Change Password",-1))]),e("form",{onSubmit:T(m,["prevent"]),class:"space-y-4"},[e("div",ge,[s[6]||(s[6]=e("label",{class:"text-sm font-medium text-slate-300"},"Current Password",-1)),P(e("input",{"onUpdate:modelValue":s[1]||(s[1]=w=>v(u)?u.value=w:null),type:"password",placeholder:"Enter current password",class:"w-full bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all",required:""},null,512),[[$,t(u)]])]),e("div",we,[s[7]||(s[7]=e("label",{class:"text-sm font-medium text-slate-300"},"New Password",-1)),P(e("input",{"onUpdate:modelValue":s[2]||(s[2]=w=>v(n)?n.value=w:null),type:"password",placeholder:"Enter new password",class:"w-full bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all",required:""},null,512),[[$,t(n)]])]),e("div",xe,[s[8]||(s[8]=e("label",{class:"text-sm font-medium text-slate-300"},"Confirm New Password",-1)),P(e("input",{"onUpdate:modelValue":s[3]||(s[3]=w=>v(i)?i.value=w:null),type:"password",placeholder:"Confirm new password",class:"w-full bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all",required:""},null,512),[[$,t(i)]])]),t(f)?(p(),b("div",he,_(t(f)),1)):k("",!0),e("div",ve,[e("button",{type:"button",onClick:s[4]||(s[4]=w=>l.$emit("update:modelValue",!1)),class:"flex-1 px-4 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 text-white text-sm font-medium border border-white/5 transition-colors"}," Cancel "),e("button",{type:"submit",disabled:t(c),class:"flex-1 px-4 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-50 flex items-center justify-center"},[t(c)?(p(),b("div",Pe)):(p(),b("span",_e,"Update Password"))],8,ye)])],32)])])])):k("",!0)]),_:1})]))}},ke=j($e,[["__scopeId","data-v-292ef435"]]),Ve={class:"max-w-2xl"},Ce={class:"space-y-6 p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm"},Ee={class:"flex items-center gap-4 pb-6 border-b border-white/5"},Se={class:"w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg shadow-indigo-500/20"},Ue={class:"text-xl font-semibold text-white"},Me={class:"text-slate-400"},Te={key:0,class:"inline-flex items-center gap-1 mt-1 px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-500/20 text-indigo-400"},Ne={class:"space-y-2"},Re={class:"flex gap-3"},je=["disabled"],Le={key:0},Ae={key:1,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Be={class:"space-y-2"},Oe={class:"flex gap-3"},qe={class:"flex-1 bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-slate-400"},ze={class:"space-y-2"},Fe={class:"flex gap-3"},De={key:0,class:"pt-4 border-t border-white/5"},Ie={class:"flex items-center justify-between"},Ye=["disabled"],Ge={class:"pt-4 border-t border-white/5"},st={__name:"settings",setup(y){const a=Y(),V=G(),x=d(null),u=d(""),n=d(""),i=d({name:a.userProfile.name}),c=d(!1),f=d(!1),m=d(!1),l=d(!1);E(()=>a.userProfile.name,r=>{i.value.name=r});const s=(r,o)=>{u.value=r,n.value=o,x.value?.show()},w=async()=>{if(i.value.name.trim()!==a.userProfile.name){m.value=!0;try{const r=await $fetch("/api/admin/update-name",{method:"POST",body:{name:i.value.name.trim()}});a.userProfile.name=r.name,s("Name Updated","Your display name has been updated.")}catch(r){s("Error",r.data?.message||"Failed to update name")}finally{m.value=!1}}},B=r=>{a.userProfile.email=r.email,s("Email Updated","Your email address has been updated.")},O=()=>{s("Password Updated","Your password has been changed successfully.")},q=async()=>{l.value=!0;try{const r=await $fetch("/api/admin/toggle-registration",{method:"POST"});a.userProfile.allowRegistration=r.allowRegistration,s("Settings Updated",r.message)}catch(r){s("Error",r.data?.message||"Failed to toggle registration")}finally{l.value=!1}},z=async()=>{try{await $fetch("/api/admin/auth/logout",{method:"POST"}),a.logout(),V.push("/login")}catch(r){console.error("Logout failed:",r)}};return(r,o)=>{const F=ue,D=ke,I=J;return p(),b("div",Ve,[o[14]||(o[14]=e("h1",{class:"text-3xl font-display font-bold text-white mb-8"},"Settings",-1)),e("div",Ce,[e("div",Ee,[e("div",Se,_(t(a).userProfile.name?.charAt(0)?.toUpperCase()||"A"),1),e("div",null,[e("h2",Ue,_(t(a).userProfile.name),1),e("p",Me,_(t(a).userProfile.email),1),t(a).userProfile.isPrimary?(p(),b("span",Te,[g(t(K),{class:"w-3 h-3"}),o[5]||(o[5]=C(" Primary Admin ",-1))])):k("",!0)])]),e("div",Ne,[o[6]||(o[6]=e("label",{class:"text-sm font-medium text-slate-300"},"Display Name",-1)),e("div",Re,[P(e("input",{"onUpdate:modelValue":o[0]||(o[0]=h=>t(i).name=h),type:"text",class:"flex-1 bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all"},null,512),[[$,t(i).name]]),e("button",{onClick:w,disabled:t(m)||t(i).name===t(a).userProfile.name,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition-all shadow-lg shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[t(m)?(p(),b("div",Ae)):(p(),b("span",Le,"Save"))],8,je)])]),e("div",Be,[o[8]||(o[8]=e("label",{class:"text-sm font-medium text-slate-300"},"Email Address",-1)),e("div",Oe,[e("div",qe,_(t(a).userProfile.email),1),e("button",{onClick:o[1]||(o[1]=h=>c.value=!0),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg font-medium transition-all border border-white/10 flex items-center gap-2"},[g(t(L),{class:"w-4 h-4"}),o[7]||(o[7]=C(" Change ",-1))])])]),e("div",ze,[o[11]||(o[11]=e("label",{class:"text-sm font-medium text-slate-300"},"Password",-1)),e("div",Fe,[o[10]||(o[10]=e("div",{class:"flex-1 bg-slate-950 border border-white/10 rounded-xl px-4 py-3 text-slate-400"}," •••••••••••• ",-1)),e("button",{onClick:o[2]||(o[2]=h=>f.value=!0),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg font-medium transition-all border border-white/10 flex items-center gap-2"},[g(t(A),{class:"w-4 h-4"}),o[9]||(o[9]=C(" Change ",-1))])])]),t(a).userProfile.isPrimary?(p(),b("div",De,[e("div",Ie,[o[12]||(o[12]=e("div",null,[e("h3",{class:"text-sm font-medium text-slate-300"},"Allow Registration"),e("p",{class:"text-xs text-slate-500 mt-0.5"}," Enable new admins to create accounts ")],-1)),e("button",{onClick:q,disabled:t(l),class:S(["w-12 h-7 rounded-full relative transition-colors",t(a).userProfile.allowRegistration?"bg-indigo-600":"bg-slate-700"])},[e("div",{class:S(["absolute top-1 w-5 h-5 bg-white rounded-full transition-all duration-300",t(a).userProfile.allowRegistration?"right-1":"left-1"])},null,2)],10,Ye)])])):k("",!0),e("div",Ge,[e("button",{onClick:z,class:"w-full px-4 py-3 bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 rounded-xl font-medium transition-all border border-rose-500/20 flex items-center justify-center gap-2"},[g(t(Q),{class:"w-4 h-4"}),o[13]||(o[13]=C(" Sign Out ",-1))])])]),g(F,{modelValue:t(c),"onUpdate:modelValue":o[3]||(o[3]=h=>v(c)?c.value=h:null),onSuccess:B},null,8,["modelValue"]),g(D,{modelValue:t(f),"onUpdate:modelValue":o[4]||(o[4]=h=>v(f)?f.value=h:null),onSuccess:O},null,8,["modelValue"]),g(I,{ref_key:"toastRef",ref:x,title:t(u),message:t(n)},null,8,["title","message"])])}}};export{st as default};
