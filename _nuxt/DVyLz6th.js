import{_ as A}from"./GtVa9oUz.js";import{r as m,k as B,c as n,a as t,t as r,q as a,G as V,b as P,F as v,p as g,m as F,o as i,y as R}from"./CNKXovMc.js";const $={class:"space-y-8"},N={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},L={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},M={class:"text-3xl font-display font-bold text-white"},O={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},U={class:"text-3xl font-display font-bold text-white"},q={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 relative overflow-hidden"},z={class:"text-3xl font-display font-bold text-white"},E={class:"mt-4 h-1 w-full bg-slate-800 rounded-full overflow-hidden"},I={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm flex flex-col"},G={class:"h-64 w-full"},H={class:"mt-4 flex justify-between text-xs text-slate-500"},J={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},K={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm"},Q={class:"space-y-5"},W={class:"flex justify-between text-sm mb-1"},X={class:"text-slate-300 font-medium"},Y={class:"text-slate-400"},Z={class:"h-2 w-full bg-slate-950 rounded-full overflow-hidden border border-white/5"},tt={key:0,class:"text-sm text-slate-500 italic text-center py-4"},et={class:"p-6 rounded-2xl bg-slate-900/40 border border-white/5 backdrop-blur-sm"},st={class:"flex items-center gap-8 mb-8"},lt={class:"relative w-40 h-40"},ot={class:"w-full h-full -rotate-90",viewBox:"0 0 32 32"},at=["stroke","stroke-dasharray","stroke-dashoffset"],nt={class:"absolute inset-0 flex items-center justify-center"},rt={class:"text-center"},it={class:"text-2xl font-bold text-white"},dt={class:"flex-1 space-y-3"},ct={class:"text-sm text-slate-300 flex-1"},ut={class:"text-sm text-slate-400"},mt={class:"text-sm text-slate-400"},ft={__name:"analytics",setup(pt){const c=m({pipelineValue:0,avgContractValue:0,retentionRate:0}),w=m([]),_=m([]),h=m([]),b=m([]),k=m(0),y=m("Loading insights..."),f=["bg-indigo-500","bg-purple-500","bg-emerald-500","bg-amber-500","bg-rose-500","bg-sky-500"],j=["#6366f1","#a855f7","#10b981","#f59e0b","#f43f5e","#0ea5e9"],S=async()=>{try{const l=await $fetch("/api/admin/analytics-stats");c.value={pipelineValue:l.pipelineValue||0,avgContractValue:l.avgContractValue||0,retentionRate:l.retentionRate||0},w.value=l.chartData||[],_.value=l.revenueTrends||[];const e=l.maxClientValue||1;h.value=(l.topClients||[]).map((s,d)=>({...s,color:f[d%f.length],percentage:Math.round(s.value/e*100)}));let p=0;b.value=(l.projectTypes||[]).map((s,d)=>{const x=s.percentage,u={...s,bgColor:f[d%f.length],strokeColor:j[d%j.length],dashArray:x,dashOffset:p};return p+=x,u}),k.value=l.totalProjects||0,y.value=l.insights||"Add projects to see insights here."}catch(l){console.error("Failed to fetch analytics data:",l),y.value="Failed to load analytics data."}};B(()=>{S()});const C=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),D=()=>{const l=["Month","Revenue","Chart Value (%)"],e=_.value.map((o,T)=>[o.month,o.value,w.value[T]||0]),p=[[],["Summary Metrics"],["Pipeline Value",c.value.pipelineValue],["Avg Contract Value",c.value.avgContractValue],["Retention Rate (%)",c.value.retentionRate],[],["Top Clients"],...h.value.map(o=>[o.name,o.value]),[],["Project Types"],...b.value.map(o=>[o.name,o.count,`${o.percentage}%`])],s=[l.join(","),...e.map(o=>o.join(",")),...p.map(o=>o.join(","))].join(`
`),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(d),u=document.createElement("a");u.setAttribute("href",x),u.setAttribute("download",`analytics_report_${new Date().toISOString().split("T")[0]}.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)};return(l,e)=>{const p=A;return i(),n("div",$,[t("div",{class:"flex items-center justify-between"},[e[0]||(e[0]=t("div",null,[t("h1",{class:"text-3xl font-display font-bold text-white mb-2"},"Analytics"),t("p",{class:"text-slate-400"},"Business metrics and project insights.")],-1)),t("div",{class:"flex gap-2"},[t("button",{onClick:D,class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg text-sm font-medium border border-white/10 transition-colors"}," Download CSV ")])]),t("div",N,[t("div",L,[e[1]||(e[1]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[2]||(e[2]=t("p",{class:"text-slate-400 text-sm mb-1"},"Pipeline Value",-1)),t("p",M,r(C(a(c).pipelineValue)),1),e[3]||(e[3]=t("p",{class:"text-xs text-slate-500 mt-2"},"Pending projects waiting in queue",-1))]),t("div",O,[e[4]||(e[4]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[5]||(e[5]=t("p",{class:"text-slate-400 text-sm mb-1"},"Avg. Contract Value",-1)),t("p",U,r(C(a(c).avgContractValue)),1),e[6]||(e[6]=t("div",{class:"mt-4 h-1 w-full bg-slate-800 rounded-full overflow-hidden"},[t("div",{class:"h-full bg-emerald-500 w-[65%]"})],-1))]),t("div",q,[e[7]||(e[7]=t("div",{class:"absolute right-0 top-0 w-32 h-32 bg-purple-500/10 rounded-full blur-2xl -mr-10 -mt-10"},null,-1)),e[8]||(e[8]=t("p",{class:"text-slate-400 text-sm mb-1"},"Client Retention",-1)),t("p",z,r(a(c).retentionRate)+"%",1),t("div",E,[t("div",{class:"h-full bg-purple-500 transition-all duration-500",style:V({width:a(c).retentionRate+"%"})},null,4)])])]),t("div",I,[e[9]||(e[9]=t("div",{class:"flex items-center justify-between mb-6"},[t("div",null,[t("h2",{class:"text-lg font-display font-semibold text-white"},"Revenue Trends"),t("p",{class:"text-xs text-slate-500 mt-1"},"Based on project start dates (active + completed)")])],-1)),t("div",G,[P(p,{data:a(w)},null,8,["data"])]),t("div",H,[(i(!0),n(v,null,g(a(_),(s,d)=>(i(),n("span",{key:d,class:"flex-1 text-center"},r(s.month),1))),128))])]),t("div",J,[t("div",K,[e[10]||(e[10]=t("h3",{class:"text-lg font-display font-semibold text-white mb-6"},"Top Clients",-1)),t("div",Q,[(i(!0),n(v,null,g(a(h),s=>(i(),n("div",{key:s.name,class:"group"},[t("div",W,[t("span",X,r(s.name),1),t("span",Y,r(C(s.value)),1)]),t("div",Z,[t("div",{class:R(["h-full rounded-full transition-all duration-1000 group-hover:brightness-125",s.color]),style:V({width:s.percentage+"%"})},null,6)])]))),128)),a(h).length===0?(i(),n("div",tt," No project data available yet. ")):F("",!0)])]),t("div",et,[e[12]||(e[12]=t("h3",{class:"text-lg font-display font-semibold text-white mb-6"},"Project Type Breakdown",-1)),t("div",st,[t("div",lt,[(i(),n("svg",ot,[(i(!0),n(v,null,g(a(b),(s,d)=>(i(),n("circle",{key:s.name,r:"16",cx:"16",cy:"16",fill:"transparent",stroke:s.strokeColor,"stroke-width":"6","stroke-dasharray":`${s.dashArray} 100`,"stroke-dashoffset":`-${s.dashOffset}`,class:"transition-all duration-500"},null,8,at))),128))])),t("div",nt,[t("div",rt,[t("p",it,r(a(k)),1),e[11]||(e[11]=t("p",{class:"text-xs text-slate-500"},"Projects",-1))])])]),t("div",dt,[(i(!0),n(v,null,g(a(b),s=>(i(),n("div",{key:s.name,class:"flex items-center gap-3"},[t("div",{class:R(["w-3 h-3 rounded-full",s.bgColor])},null,2),t("span",ct,r(s.name),1),t("span",ut,r(s.count)+" ("+r(s.percentage)+"%)",1)]))),128))])]),t("p",mt,r(a(y)),1)])])])}}};export{ft as default};
